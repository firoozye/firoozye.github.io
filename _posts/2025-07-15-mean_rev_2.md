---
layout: post
title: "Trading Mid-Frequency and RV lie a Pro (Part 2): How to scale trades"
date:   2025-08-01 00:00:00 +0000
author:  Dr. Nick Firoozye
description: “This post discusses  how to trade mean-reversion after it's been identified."
---

<!-- This is a GitHub-specific comment "ä ü ö"-->

# Introduction

Mean reversion trading can be as simple as forecasting the level (or spread) we want to trade, and allocating relative to the forecast,
i.e., in the simple case of an  AR(1) model (or Ornstein-Uhlenbeck process), we have a model such as
\\[ \Delta y_t = \alpha + \beta y_{t-1} + \epsilon_t \\]
where \\(y_t\\) is the level (or spread) at time \\(t\\) and \\(\Delta y_t \equiv y_t - y_{t-1}\\),
 is the backward differences, \\(\alpha\\) is the long-term mean, \\(\beta\\) is the autoregressive coefficient,
and \\(\epsilon_t\\) is a white noise error term (although we may have other terms in the model, such as a trend, or a seasonal, or some AR terms
to capture the short-run dynamics). 

In such a model,  if we recast it as 

$$y_t = (1+\beta) \bigl(\frac{\alpha}{1+\beta} + y_{t-1}\bigr) +  \epsilon_t, $$

we can see that the model is mean-reverting if \\(-1< \beta < 0\\),
where the long-run mean is given by \\(-\frac{\alpha}{\beta}\\),
and the speed of mean reversion is given by the coefficient \\(1+\beta\\).

With this model we can forecast the level as:

$$\hat{y}_t = \hat{\alpha} + (1+\hat{\beta}) y_{t-1},$$

where \\(\hat{\alpha}\\) and \\(\hat{\beta}\\) are the estimated coefficients from the model,
(i.e., they are just found via the OLS regression of \\(y_t\\) on \\(y_{t-1}\\)).
As we mentioned, we could have also considered adding more AR terms, or a trend or a seasonal component.

No matter how complex the model, it is possible to forecast one period ahead (as we have done above for one period), or longer periods ahead, by recursively applying the model
or "bootstrapping" the forecast.

# Optimal Trading Strategies

## Optimal Mean Reversion Trading with an AR(1) Process and Fixed Costs

One standard method for trading given forecasts and fixed transaction costs is to apply a single-period Mean-Variance Optimization (MVO) framework and 
explicitly incorporates fixed transaction costs or _slippage costs_ (i.e., assuming we can trade at the  _top of book_ -- executing at the best bid or best ask without moving the market).

### 1. The Model

#### Asset Price Dynamics: AR(1) Process

We model the change in the asset price,\\(y_t\\), using a first-order autoregressive (AR(1)) process, which captures mean reversion:

$$ y_{t+1} - y_t = \alpha(\mu - y_t) + \epsilon_{t+1} $$

Where:
- \\(y_t\\): The price of the asset at time \\(t\\).
- \\(\mu\\): The long-term mean price to which the asset reverts.
- \\(\alpha\\): The speed of mean reversion, where \\(0 < \alpha < 1\\)
- \\(\epsilon_{t+1}\\): A white noise shock term with \\(E[\epsilon_{t+1}] = 0\\) and variance \\(Var(\epsilon_{t+1}) = \sigma_{\epsilon}^2\\).

#### One-Period Ahead Return & Risk

Given the price at time \\(t\\), the conditional expected return and variance for the next period (\\(t+1\\)) are:

- **Expected Return**: We define the return in this instance to be the price-change, i.e., \\(R_{t+1 }= y_{t+1} - y_t\\) and so 
 \\(E_t[R_{t+1}] = \alpha(\mu - y_t)\\) 
- **Variance of Return**: \\( Var_t(R_{t+1}) = \sigma_{\epsilon}^2 \\)

### 2. Optimal Allocation with Transaction Costs

The strategy involves defining a **no-trade zone** around the frictionless optimal allocation. A trade is executed only when the current holding falls 
outside this zone. Let \\(h_{t-}\\) be the holding *before* a potential trade at time \\(t\\), and let \\(c\\) be the fixed transaction cost 
per unit traded (i.e., \\(\frac{(ask-bid)}{2}\\)). 
The investor's risk aversion is given by \\(\gamma\\).
The utility function to be maximized at each time step is:

$$ U(h_t) = \underbrace{E_t[R_{t+1}] \cdot h_t - \frac{1}{2} \gamma \sigma_{\epsilon}^2 h_t^2}_{\text{Mean-Variance Utility}} - \underbrace{c |h_t - h_{t-}|}_{\text{Slippage Cost}} $$

Where:
- \\(h_t\\): The new position (allocation) at time \\(t\\)
- \\(h_{t-}\\): The position held just before trading at time \\(t\\)
- \\( \|h_t - h_{t-}\| \\) : The absolute value of the change in position, representing the  _trades_ in that period.
- \\(c\\): The fixed transaction cost per unit traded.
Maximizing this utility with respect to \\(h_t\\) leads to the first-order condition we describe below.
We note that in the case of no transaction costs, the optimal allocation would be \\(h_t = \frac{E_t[R_{t+1}]}{\gamma \sigma_{\epsilon}^2}\\), 
which is the standard MVO based holdings.

#### Boundary Formulas
Optimal trading with fixed costs leads to trading up to a no-trade zone around the frictionless (i.e., no transaction cost) optimal allocation. 
If the current holding is outside this zone, a trade is executed to bring the holding back into the zone. If the current holding is already within the zone,
no trade is executed.

The no-trade zone is an interval \\([L(S_t), U(S_t)]\\) defined by a lower (buy) boundary and an upper (sell) boundary.

- **Lower Boundary (Buy Threshold) \\(L(S_t)\\)**:
  $$ L(S_t) = \frac{E_t[R_{t+1}] - c}{\gamma \sigma_{\epsilon}^2} = \frac{\alpha(\mu - S_t) - c}{\gamma \sigma_{\epsilon}^2} $$

- **Upper Boundary (Sell Threshold) \\(U(S_t)$**:
  $$ U(S_t) = \frac{E_t[R_{t+1}] + c}{\gamma \sigma_{\epsilon}^2} = \frac{\alpha(\mu - S_t) + c}{\gamma \sigma_{\epsilon}^2} $$

The width of this no-trade zone is constant: \\(U(S_t) - L(S_t) = \frac{2c}{\gamma \sigma_{\epsilon}^2}\\).

#### Complete Trading Rules

The optimal allocation, \\(h_t\\), is determined by the following rules:

1.  **If the current holding is below the zone (\\(h_{t-} < L(S_t)\\)):**
    The expected benefit of increasing the position outweighs the cost.  **Action**: **BUY** to bring the holding up to the lower boundary .
    $$ h_t = L(S_t) $$

2.  **If the current holding is above the zone (\\(h_{t-} > U(S_t)\\) ):**
    The expected benefit of decreasing the position outweighs the cost.   **Action**: **SELL** to bring the holding down to the upper boundary.
    $$ h_t = U(S_t) $$

3.  **If the current holding is within the zone (\\(L(S_t) \le h_{t-} \le U(S_t)\\) ):**
    The expected benefit of a trade is insufficient to cover the cost.  **Action**: **DO NOT TRADE**.
    $$ h_t = h_{t-} $$

4. We can encapuslate the above rules in a single formula using the clip function (e.g., in Pandas)
given that \\(E_t[R_{t+1}] = \alpha(\mu - y_t)\\) 
```python
L_S_t = (alpha*(mu - y_t) - c) / (gamma * sigma_epsilon**2)
U_S_t = (alpha* (mu - y_t) + c) / (gamma * sigma_epsilon**2)
h_t = np.clip(h_t-, L_S_t, U_S_t)
```

---

## Optimal Trading with Market Impact Costs

For anything but the smallest trade size it is unrealistic to assume that we can trade at the top of book without moving the market.
In practice, larger trades will impact the market price, leading to non-linear transaction costs. This section discusses how to adapt the MVO framework to account for market impact costs, which are typically convex in nature.
Consequently, we wish to extend the single-period Mean-Variance Optimization (MVO) framework to include non-linear transaction costs, specifically market impact. 
Unlike fixed costs which lead to a "no-trade" zone, convex market impact costs result in a strategy of continuous and smooth trading. (the continuous trading 
is also known as "partial adjustment" or "gradual trading" and is sometimes a reason why some traders will not use these models).

### 1. The General Utility Function

We augment the standard MVO utility by subtracting a cost term that is a function of the trade size. Let:
- \\(h_t\\): The new position (allocation) at time \\(t\\).
- \\(h_{t-}\\): The position held just before trading at time \\(t\\).
- \\( \|h_t - h_{t-}\| \\): the turnover or the size of the trade.
- \\(\lambda\\): A parameter representing the strength of the market impact. Higher \\(\lambda\\) implies higher trading costs.
- \\(\beta\\): The power of the cost function (e.g., \\(3/2\\) or \\(2\\)).

The general utility function, \\(U(h_t)\\), to be maximized at each time step is:

$$ U(h_t) = \underbrace{E_t[R_{t+1}] \cdot h_t - \frac{1}{2}\gamma \sigma_{\epsilon}^2 h_t^2}_{\text{Mean-Variance Utility}} - \underbrace{\lambda |h_t - h_{t-}|^{\beta}}_{\text{Market Impact Cost}} $$

The convexity of the cost function for \\(\beta > 1\\) ensures that the marginal cost of trading increases with trade size, which incentivises smaller, 
more frequent trades over large, abrupt ones. Most commonly \\(\beta\\) is set to \\(3/2\\)  (or close to that by most market participants) while economists tend to
like the power of \\(2\\) because it can be grounded in the Kyle Model (as well as leading to closed-form solutions)  These  lead to different optimal trading strategies.

---

### 2. Case 1: Market Impact with \\(|\text{turnover}|^{3/2}\\) (Square-Root Impact Law)

As mentioned above, this model is frequently used in academic literature and is supported by empirical analysis of trade data, often referred to as the "square-root impact law."

#### Utility Function

$$ U(h_t) = E_t[R_{t+1}] \cdot h_t - \frac{1}{2}\gamma \sigma_{\epsilon}^2 h_t^2 - \lambda |h_t - h_{t-}|^{\frac{3}{2}} $$

#### Characterizing the Optimal Solution

To find the optimal holding \\(h_t\\), we take the derivative of the utility function with respect to \\(h_t\\) and set it to zero. This results in a **non-linear equation**:

$$ \frac{\partial U(h_t)}{\partial h_t} = E_t[R_{t+1}] - \gamma \sigma_{\epsilon}^2 h_t - \frac{3}{2}\lambda |h_t - h_{t-}|^{\frac{1}{2}} \cdot \text{sign}(h_t - h_{t-}) = 0 $$

**Strategy and Intuition:**
- **No Closed-Form Solution**: Due to the non-linearity, there is no simple, explicit formula for \\(h_t\\). The optimal allocation must be found at each step using a numerical root-finding algorithm.
- **Partial Adjustment**: The optimal strategy is to always trade towards the frictionless target (\\(h^* = E_t[R_{t+1}] / (\gamma \sigma_{\epsilon}^2)\\)), but never to reach it in a single step (unless \\(h_{t-} = h^*$). You only close a fraction of the gap.
- **No "No-Trade" Zone**: A trade is almost always optimal, however small. The only time no trade occurs is if the prior holding \\(h_{t-}\\) 
- happens to be exactly at the new optimal level.
- Solutions can be found using numerical methods in 1d. In higher dimensions, convex optimization methods can be used (see for example, CVXPY or CVXPortfolio in Python). 

---

### 3. Case 2: Market Impact with \\(|\text{turnover}|^2\\) (Kyle-like Model)

This model is popular in economic theory due to its mathematical tractability, which allows for a clean, closed-form solution.

#### Utility Function

$$ U(h_t) = E_t[R_{t+1}] \cdot h_t - \frac{1}{2}\gamma \sigma_{\epsilon}^2 h_t^2 - \lambda (h_t - h_{t-})^2 $$

#### Characterizing the Optimal Solution

The quadratic nature of the cost function makes the first-order condition a **linear equation** in \\(h_t\\), which is easily solved.

$$ \frac{\partial U(h_t)}{\partial h_t} = E_t[R_{t+1}] - \gamma \sigma_{\epsilon}^2 h_t - 2\lambda(h_t - h_{t-}) = 0 $$

Solving for \\(h_t\\) yields, plugging in the expected return:

$$ h_t = \frac{\alpha (\mu - y_t)}{\gamma \sigma_{\epsilon}^2 + 2\lambda} + \frac{2\lambda}{\gamma \sigma_{\epsilon}^2 + 2\lambda} h_{t-} $$

**Strategy and Intuition:**

This solution has a very elegant and intuitive structure. If we define the frictionless target holding as 
\\(h^* = \frac{\alpha(\mu - y_t) }{\gamma \sigma_{\epsilon}^2}\\), we can rewrite the solution as:

$$ h_t = \left(\frac{\gamma \sigma_{\epsilon}^2}{\gamma \sigma_{\epsilon}^2 + 2\lambda}\right) h^* + \left(\frac{2\lambda}{\gamma \sigma_{\epsilon}^2 + 2\lambda}\right) h_{t-} $$

- **Weighted Average**: The optimal holding \\(h_t\\) is a simple weighted average of the ideal frictionless target \\(h^*\\) and the previous holding \\(h_{t-}\\).
- **Trading Speed**: The fraction of the gap between the current holding and the target that is closed in each period is constant and equal to 
- \\(\frac{\gamma \sigma_{\epsilon}^2}{\gamma \sigma_{\epsilon}^2 + 2\lambda}\\). This term can be interpreted as the "speed of trading."
- **Impact of Costs**: As market impact costs \\(\lambda\\) increase, the weight shifts towards the previous holding \\(h_{t-}\\), leading to slower trading. 
If \\(\lambda=0\\), the formula collapses to \\(h_t = h^*\\), as expected.

## Conclusion
In this post, we have discussed how to trade mean-reversion strategies after identifying the level or spread to trade. We have covered two main approaches: one with fixed transaction costs and another with market impact costs.
The fixed costs approach leads to a no-trade zone, while the market impact approach results in continuous trading strategies. The latter can be modeled with either a 
\\(\|\text{turnover}\|^{3/2}\\) or \\(\|\text{turnover}\|^2\\) cost structure, each leading to different optimal trading behaviors.
The choice of model depends on the specific characteristics of the asset being traded and the trader's preferences regarding risk and transaction costs.
In practice, traders often use a combination of these models, adjusting parameters based on empirical data and market conditions to optimize their trading strategies.
New research continues to explore more complex models and multi-period trading strategies, although in practice, most traders will use a single-period model, perhaps 
with adjustments for the specific asset class and the alpha decay of their given strategy.


---

## References

### Allocation with Fixed Costs
*   Davis, M. H. A., and Norman, A. R. (1990). "Portfolio Selection with Transaction Costs." *Mathematics of Operations Research*, 15(4), 676–713.
*   Mei, X., DeMiguel, V., & Nogales, F. J. (2016). "Multiperiod portfolio optimization with multiple risky assets and general transaction costs." *Available at [LBS](https://lbsresearch.london.edu/id/eprint/199/1/VdeMiguel_Multiperiod_Portfolio_Optimization_2016_CC_licence.pdf)*.


### Market Impact Costs & Optimal Execution
*   Bouchaud, J.-P., Farmer, J. D., & Lillo, F. (2009). "How markets slowly digest changes in supply and demand." In *Handbook of Financial Markets: Dynamics and Evolution*.
*   Kyle, A. S. (1985). "Continuous Auctions and Insider Trading." *Econometrica*, 53(6), 1315–1335.

### Multiperiod Trading Strategies
-   Boyd, S., Busseti, E., Diamond, S, Kahn, R., Koh, K, Nystrup, P and Speth J., Multi-Period Trading via Convex Optimization, Fourndations and Trends in Optimization, vol 3, no 1, 1-76.
*   Garleanu, N., & Pedersen, L. H. (2013). "Dynamic Trading with Predictable Returns and Transaction Costs." *Journal of Finance*, 68(6), 2309–2340.

### Mean-Reverting Trading Strategies and Stop-Losses / Take-Profits
*   Lipton, A., & De Prado, M. L. (2020). A closed-form solution for optimal mean-reverting trading strategies. [ArXiv](https://arxiv.org/abs/2003.10502).


## Recommended Courses 

* [Fundamentals of Algorithmic Trading](https://rebrand.ly/ndzrcki), on the WBS/Quantshub Platform. This introductory course describes the Algo Trading Sector and common roles for quants, before discussing
the overall trading framework with a case study on crypto.
* [Algorithmic Trading Certificate(ATC): A Practitioner’s Guide](https://rebrand.ly/cbadu1x)
For a much more detailed discussion, the Algorithmic Trading Certificate,
which is available on the WBS Platform, covers the topic in much more detail,
including the statistical tests, the trading strategies, and the implementation details. It is available
both as a self-paced course, and a hybrid course with live sessions.

Finally, I am working on a book on Algorithmic Trading, together with Dr Brian Healy, which will cover the topic in much more detail, including the statistical tests,
the trading strategies, and the implementation in far more detail.

